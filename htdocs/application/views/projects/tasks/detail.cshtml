@{
use Scabbia\Extensions\Http\Http;
use Scabbia\Extensions\Helpers\Html;
use Scabbia\Extensions\Helpers\Date;
use Scabbia\Extensions\Helpers\String;
use Scabbia\Extensions\Session\Session;
use Scabbia\Extensions\Views\Views;
use Scabbia\Extensions\I18n\I18n;
use App\Includes\ViewHelpers;
}
@Views::viewFile('{app}views/shared/header.cshtml')
@Views::viewFile('{app}views/shared/nav/project.cshtml', $model)

<section id="main">
@Views::viewFile('{app}views/shared/top_navigation.cshtml', $model)

    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                @if (!is_null($alert = Session::getFlash('alert'))) {
                <div class="alert alert-@$alert[0]">
                    @$alert[1]
                </div>
                }

                <div class="box" style="position:relative;">
                    <div class="tab-header">Task Details</div>

                    <div class="tab-pane padded">
                        <div class="pull-right">
                            <a href="@Http::url('projects/tasks/' . $projectId . '/edit/' . $id)">
                                <button type="submit" class="button blue">@I18n::_('Task Edit')</button>
                            </a>
                        </div>
                    </div>

                    <div class="padded">

                        <div class="row-fluid">
                            <div class="span4">
                                <div class="field">
                                    <label for="Type" class="caption">@I18n::_('Type')</label>
                                    <span class="value">@$constants['task_type'][(int)$data['type']]['name']</span>
                                </div>
                            </div>
                            <div class="span4">
                                <div class="field">
                                    <label for="Section" class="caption">@I18n::_('Section')</label>
                                    <span class="value">@$projectConstants['section_type'][(int)$data['section']]['name']</span>
                                </div>
                            </div>
                            <div class="span4">
                                <div class="field">
                                    <label for="Milestone" class="caption">@I18n::_('Milestone')</label>
                                    <span class="value">@$projectConstants['milestone_type'][(int)$data['milestone']]['name']</span>
                                </div>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="field">
                                <label for="Name" class="caption">@I18n::_('Subject')</label>
                                <span class="value">@String::htmlEscape($data['subject'])</span>
                            </div>
                            <div class="field">
                                <label for="Description" class="caption">@I18n::_('Description')</label>
                                <span class="value">@String::htmlEscape($data['description'])</span>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span4">
                                <div class="field">
                                    <label for="Status" class="caption">@I18n::_('Status')</label>
                                    <span class="value">
                                    @if (isset($constants['open_task_type'][(int)$data['status']])) {
                                        @$constants['open_task_type'][(int)$data['status']]['name']
                                    } elseif (isset($constants['closed_task_type'][(int)$data['status']])) {
                                        @$constants['closed_task_type'][(int)$data['status']]['name']
                                    } else {
                                        @I18n::_('Unknown')
                                    }
                                    </span>
                                </div>
                            </div>
                            <div class="span4">
                                <div class="field">
                                    <label for="StartDate" class="caption">@I18n::_('Start Date')</label>
                                    <span class="value">@Date::convert($data['startdate'], 'Y-m-d H:i:s', 'd/m/Y')</span>
                                </div>
                            </div>
                            <div class="span4">
                                <div class="field">
                                    <label for="DueDate" class="caption">@I18n::_('Due Date')</label>
                                    <span class="value">
                                    @if ((int)$data['duedate'] != null) {
                                        @Date::convert($data['duedate'], 'Y-m-d H:i:s', 'd/m/Y')
                                    } else {
                                        @I18n::_('(Unspecified)')
                                    }
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span4">
                                <div class="field">
                                    <label for="Priority" class="caption">@I18n::_('Priority')</label>
                                    <span class="value">@$constants['priority_type'][(int)$data['priority']]['name']</span>
                                </div>
                            </div>
                            <div class="span4">
                                <div class="field">
                                    <label for="EndDate" class="caption">@I18n::_('End Date')</label>
                                    <span class="value">
                                    @if ((int)$data['enddate'] != null) {
                                        @Date::convert($data['enddate'], 'Y-m-d H:i:s', 'd/m/Y')
                                    } else {
                                        @I18n::_('(Unspecified)')
                                    }
                                    </span>
                                </div>
                            </div>
                            <div class="span4">
                                <div class="field">
                                    <label for="EstimatedTime" class="caption">@I18n::_('Estimated Time')</label>
                                    <span class="value">@String::htmlEscape($data['estimatedtime'])</span>
                                </div>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span4">
                                <div class="field">
                                    <label for="Assignee" class="caption">@I18n::_('Assignee')</label>
                                    <span class="value">
                                    @if ((int)$data['assignee'] != 0) {
                                        @$users[(int)$data['assignee']]['name']
                                    } else {
                                        @I18n::_('(Unassigned)')
                                    }
                                    </span>
                                </div>
                            </div>
                            <div class="span8">
                                <div class="field">
                                    <label for="Revisions" class="caption">@I18n::_('Related Revisions')</label>
                                    <span class="value">@$data['revisions']</span>
                                </div>
                           </div>
                        </div>

                    </div>
                </div>

                <div class="box" style="position:relative;">
                    <div class="tab-header">@I18n::_('Task History')</div>
                    <div class="padded">
                        @foreach ($logs as $log) {
                        <div class="row-fluid row-border">
                            <div class="span2">@$log['usersname']</div>
                            <div class="span2">@$log['description']</div>
                            <div class="span2">@date('d/m/Y H:i', Date::fromDb($log['created']))</div>
                            <div class="span6">
                                @foreach (json_decode($log['serializeddata'], true) as $key => $value) {
                                    @if ($key == 'status') {
                                        <strong>@$key</strong>:
                                        @if (isset($constants['open_task_type'][$value])) {
                                            @$constants['open_task_type'][$value]['name']
                                        } elseif (isset($constants['closed_task_type'][$value])) {
                                            @$constants['closed_task_type'][$value]['name']
                                        } else {
                                            @I18n::_('Unknown')
                                        }
                                        <br />
                                    } else {
                                        <strong>@$key</strong>: @$value<br />
                                    }
                                }
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        }
                    </div>
                </div>
            </div>
            <div class="row-fluid">
@Views::viewFile('{app}views/shared/copyright.cshtml')
            </div>
        </div>
    </div>
</section>

@Views::viewFile('{app}views/shared/footer.cshtml')